import{G as e,al as t,am as a,g as o,r as s,o as r,c as n,w as i,b as l,h as d,t as p,j as c,k as u,i as f,R as m,Y as h,s as g,l as w,e as k,f as _,F as b}from"./index.8a89d12b.js";import{_ as y}from"./uni-dateformat.cc67f5fd.js";import{r as N}from"./uni-app.es.42fcfc95.js";import{a as L,_ as S}from"./uni-list.ff4adee6.js";import{_ as j}from"./uni-load-more.5b2735e4.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as v}from"./unicloud-db.f2f36ee8.js";import"./uni-icons.41c57c15.js";var T={en:{noData:"No Data",noNetwork:"Network error",toSet:"Go to settings",error:"error"},"zh-Hans":{noData:"暂无数据",noNetwork:"网络异常",toSet:"前往设置",error:"错误"}};const{t:D}=e(T);var C=M({name:"uni-load-state",computed:{noData:()=>D("noData"),noNetwork:()=>D("noNetwork"),toSet:()=>D("toSet"),error:()=>D("error")},data:()=>({networkType:""}),props:{state:{type:Object,default:()=>({loading:!0,hasMore:!1,pagination:{pages:0},data:[],error:{}})}},mounted(){t((({networkType:e})=>{"none"==this.networkType&&"none"!=e&&this.$emit("networkResume"),this.networkType=e})),a({success:({networkType:e})=>{this.networkType=e}})},methods:{appear(){!this.state.loading&&this.state.hasMore&&this.$emit("loadMore")},openSettings(){if("ios"==o().platform){var e=plus.ios.import("UIApplication").sharedApplication(),t=plus.ios.import("NSURL"),a=t.URLWithString("App-prefs:root=General");e.openURL(a),plus.ios.deleteObject(a),plus.ios.deleteObject(t),plus.ios.deleteObject(e)}else{var s=plus.android.importClass("android.content.Intent"),r=plus.android.importClass("android.provider.Settings"),n=plus.android.runtimeMainActivity(),i=new s(r.ACTION_SETTINGS);n.startActivity(i)}}}},[["render",function(e,t,a,o,m,h){const g=c,w=u,k=f,_=N(s("uni-load-more"),j);return r(),n(k,{onAppear:h.appear},{default:i((()=>[a.state.error?(r(),n(k,{key:0},{default:i((()=>["none"==m.networkType?(r(),n(k,{key:0,class:"box"},{default:i((()=>[l(g,{class:"icon-image",src:"./assets/disconnection.be358d85.png",mode:"widthFix"}),l(w,{class:"tip-text"},{default:i((()=>[d(p(h.noNetwork),1)])),_:1}),l(k,{class:"btn btn-default",onClick:h.openSettings},{default:i((()=>[l(w,{class:"btn-text"},{default:i((()=>[d(p(h.toSet),1)])),_:1})])),_:1},8,["onClick"])])),_:1})):(r(),n(w,{key:1,class:"error"},{default:i((()=>[d(p(h.error)+"："+p(JSON.stringify(a.state.error)),1)])),_:1}))])),_:1})):(r(),n(_,{key:1,class:"uni-load-more",status:a.state.loading?"loading":a.state.hasMore?"hasMore":"noMore"},null,8,["status"]))])),_:1},8,["onAppear"])}],["__scopeId","data-v-3c7fa5c9"]]);var R=M({data:()=>({isLoading:!0,loadMore:{contentdown:"",contentrefresh:"",contentnomore:""},readNewsLog:[],udbWhere:""}),onLoad(){this.readNewsLog=m("readNewsLog")||[];let e=this.readNewsLog.map((({article_id:e})=>e));console.log(typeof e,e),this.udbWhere=`"_id" in ${JSON.stringify(e)}`,h({title:this.$t("newsLog.navigationBarTitle")})},onPullDownRefresh(){this.refreshData()},onReachBottom(){this.$refs.udb.loadMore()},methods:{refreshData(){this.$refs.udb.loadData({clear:!0},(e=>{console.log(e),g()}))},handleItemClick(e){console.log(e),w({url:"/pages/list/detail?id="+e._id+"&title="+e.title})}}},[["render",function(e,t,a,o,c,m){const h=u,g=N(s("uni-dateformat"),y),w=f,j=N(s("uni-list-item"),L),M=N(s("uni-list"),S),T=N(s("uni-load-state"),C),D=N(s("unicloud-db"),v);return r(),n(w,{class:"container"},{default:i((()=>[l(D,{ref:"udb",where:c.udbWhere,collection:"opendb-news-articles",onLoad:t[0]||(t[0]=e=>0==c.isLoading),onError:t[1]||(t[1]=e=>0==c.isLoading),field:"title,_id","page-size":10},{default:i((({data:e,pagination:t,loading:a,hasMore:o,error:s})=>[l(M,null,{default:i((()=>[(r(!0),k(b,null,_(e,((e,t)=>(r(),n(j,{key:t,clickable:!0,onClick:t=>m.handleItemClick(e)},{body:i((()=>[l(w,{class:"item"},{default:i((()=>[l(h,null,{default:i((()=>[d(p(e.title),1)])),_:2},1024),l(g,{class:"article-date",date:c.readNewsLog[t].last_time,format:"yyyy-MM-dd hh:mm",threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024),l(T,{onNetworkResume:m.refreshData,state:{data:e,pagination:t,hasMore:o,loading:a,error:s}},null,8,["onNetworkResume","state"])])),_:1},8,["where"])])),_:1})}],["__scopeId","data-v-2e69ded5"]]);export{R as default};

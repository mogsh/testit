import{p as e,T as t,Y as a,K as i,R as s,V as o,o as l,c as d,w as n,b as r,h as c,t as u,e as f,F as _,d as h,i as m,r as p,j as g,k as w,Z as b}from"./index.8a89d12b.js";import{_ as y}from"./uni-dateformat.cc67f5fd.js";import{r as D}from"./uni-app.es.42fcfc95.js";import{a as j,_ as v}from"./uni-list.ff4adee6.js";import{_ as x}from"./unicloud-db.f2f36ee8.js";import{_ as L}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.41c57c15.js";const $=e.database().collection("read-news-log");var k=L({data:()=>({id:"",title:"title",field:"user_id.username,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:{uniStarterConfig:()=>t().globalData.config,where(){return`_id =="${this.id}"`}},onLoad(e){console.log(e),e.id&&(this.id=e.id),e.title&&(this.title=e.title,a({title:e.title}))},onReady(){this.id?this.$refs.detail.loadData():i({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(e){"share"==e.type&&this.shareClick()},methods:{$log(...e){console.log("args",...e,this.id)},setReadNewsLog(){let e={article_id:this.id,last_time:Date.now()},t=s("readNewsLog")||[],a=-1;t.forEach((({article_id:t},i)=>{t==e.article_id&&(a=i)})),-1===a?t.push(e):t.splice(a,1,e),o("readNewsLog",t),console.log(t)},setFavorite(){if(e.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");let t=this.id,a=Date.now();console.log({article_id:t,last_time:a}),$.where(`"article_id" == "${t}" && "user_id"==$env.uid`).update({last_time:a}).then((({result:{updated:e}})=>{console.log("updated",e),e||$.add({article_id:t}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadData(e){""==this.title&&e[0].title&&(this.title=e[0].title,a({title:e[0].title})),this.setReadNewsLog()},followClick(){i({title:this.$t("listDetail.follow"),icon:"none"})}}},[["render",function(e,t,a,i,s,o){const L=m,$=D(p("uni-dateformat"),y),k=D(p("uni-list-item"),j),N=D(p("uni-list"),v),C=g,R=w,E=b,F=D(p("unicloud-db"),x);return l(),d(L,{class:"article"},{default:n((()=>[r(L,{class:"article-title"},{default:n((()=>[c(u(s.title),1)])),_:1}),r(F,{options:s.formData,collection:"opendb-news-articles,uni-id-users",field:s.field,getone:!0,where:o.where,manual:!0,ref:"detail",foreignKey:"opendb-news-articles.user_id",onLoad:o.loadData},{default:n((({data:e,loading:t,error:a,options:i})=>[!t&&e?(l(),f(_,{key:0},[r(N,{border:!1},{default:n((()=>[r(k,{thumbSize:"lg",thumb:e.image},{body:n((()=>[r(L,{class:"header-content"},{default:n((()=>[r(L,{class:"uni-title"},{default:n((()=>[c(u(e.user_id&&e.user_id[0].username),1)])),_:2},1024)])),_:2},1024)])),footer:n((()=>[r(L,{class:"footer"},{default:n((()=>[r(L,{class:"uni-note"},{default:n((()=>[c("更新于 "),r($,{date:e.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["thumb"])])),_:2},1024),r(L,{class:"banner"},{default:n((()=>[r(C,{class:"banner-img",src:e.avatar,mode:"widthFix"},null,8,["src"]),r(L,{class:"banner-title"},{default:n((()=>[r(R,{class:"uni-ellipsis"},{default:n((()=>[c(u(e.excerpt),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(L,{class:"article-content"},{default:n((()=>[r(E,{nodes:e.content},null,8,["nodes"])])),_:2},1024)],64)):h("",!0)])),_:1},8,["options","field","where","onLoad"])])),_:1})}],["__scopeId","data-v-96bf7344"]]);export{k as default};

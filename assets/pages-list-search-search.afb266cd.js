import{G as e,P as a,r as t,o as s,c as l,w as c,b as o,m as i,h as r,t as n,d as h,a as d,i as u,Q as f,k as p,R as _,p as y,T as m,V as b,L as g,W as x,g as k,q as L,X as w,e as C,f as S,F as v}from"./index.8a89d12b.js";import{_ as T}from"./uni-icons.41c57c15.js";import{r as D}from"./uni-app.es.42fcfc95.js";import{_ as V}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as H}from"./unicloud-db.f2f36ee8.js";import{a as I,_ as B}from"./uni-list.ff4adee6.js";var z={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"請輸入搜索內容"}};const{t:$}=e(z);var F=V({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:"取消"},bgColor:{type:String,default:"#F8F8F8"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||$("uni-search-bar.cancel")},placeholderText(){return this.placeholder||$("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,a){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.$emit("clear",{value:this.searchVal}),this.searchVal=""},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,a())},confirm(){a(),this.$emit("confirm",{value:this.searchVal})},blur(){a(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(e,a,_,y,m,b){const g=D(t("uni-icons"),T),x=u,k=f,L=p;return s(),l(x,{class:"uni-searchbar"},{default:c((()=>[o(x,{style:d({borderRadius:_.radius+"px",backgroundColor:_.bgColor}),class:"uni-searchbar__box",onClick:b.searchClick},{default:c((()=>[o(x,{class:"uni-searchbar__box-icon-search"},{default:c((()=>[i(e.$slots,"searchIcon",{},(()=>[o(g,{color:"#c0c4cc",size:"18",type:"search"})]),!0)])),_:3}),m.show||m.searchVal?(s(),l(k,{key:0,focus:m.showSync,disabled:_.readonly,placeholder:b.placeholderText,maxlength:_.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text",modelValue:m.searchVal,"onUpdate:modelValue":a[0]||(a[0]=e=>m.searchVal=e),onConfirm:b.confirm,onBlur:b.blur,onFocus:b.emitFocus},null,8,["focus","disabled","placeholder","maxlength","modelValue","onConfirm","onBlur","onFocus"])):(s(),l(L,{key:1,class:"uni-searchbar__text-placeholder"},{default:c((()=>[r(n(_.placeholder),1)])),_:1})),m.show&&("always"===_.clearButton||"auto"===_.clearButton&&""!==m.searchVal)&&!_.readonly?(s(),l(x,{key:2,class:"uni-searchbar__box-icon-clear",onClick:b.clear},{default:c((()=>[i(e.$slots,"clearIcon",{},(()=>[o(g,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])),_:3},8,["onClick"])):h("",!0)])),_:3},8,["style","onClick"]),"always"===_.cancelButton||m.show&&"auto"===_.cancelButton?(s(),l(L,{key:0,onClick:b.cancel,class:"uni-searchbar__cancel"},{default:c((()=>[r(n(b.cancelTextI18n),1)])),_:1},8,["onClick"])):h("",!0)])),_:3})}],["__scopeId","data-v-6b860158"]]);var N,j,W,G,R,P;var M=V({data:()=>({mallGoodsDbName:"opendb-news-articles",searchLogDbName:"opendb-search-log",statusBarHeight:"0px",localSearchList:_("__local_search_history"),localSearchListDel:!1,netHotListIsHide:!1,searchText:"",iconColor:"#999999",associativeList:[],keyBoardPopup:!1,hotWorld:"DCloud",focus:!0,speechEngine:"iFly"}),created(){this.db=y.database(),this.searchLogDb=this.db.collection(this.searchLogDbName),this.mallGoodsDb=this.db.collection(this.mallGoodsDbName),this.searchText=m().globalData.searchText},computed:{associativeShow(){return this.searchText&&this.associativeList.length}},onLoad(){},methods:{clear(e){console.log("res: ",e)},confirm(e){this.search(e.value)},cancel(e){a(),this.searchText="",this.loadList()},search(e){(e||this.hotWorld)&&(e?(this.searchText!==e&&(this.searchText=e),this.localSearchListManage(e),this.searchLogDbAdd(e)):this.hotWorld&&(this.searchText=this.hotWorld),a(),this.loadList(this.searchText))},localSearchListManage(e){_("__local_search_history").length?(this.localSearchList.unshift(e),(e=>{for(let a=e.length-1;a>=0;a--){const t=e.indexOf(e[a]),s=e.lastIndexOf(e[a]);t!=s&&e.splice(s,1)}})(this.localSearchList),this.localSearchList.length>10&&this.localSearchList.pop()):this.localSearchList=[e],b("__local_search_history",this.localSearchList)},LocalSearchListClear(){g({content:"确认清空搜索历史吗",confirmText:"删除",confirmColor:"red",cancelColor:"#808080",success:e=>{e.confirm&&(this.localSearchListDel=!1,this.localSearchList=[],x("__local_search_history"))}})},LocalSearchlistItemClick(e,a){if(this.localSearchListDel)return this.localSearchList.splice(a,1),b("__local_search_history",this.localSearchList),void(this.localSearchList.length||(this.localSearchListDel=!1));this.search(e)},searchHotRefresh(){this.$refs.udb.refresh()},speech(){},searchLogDbAdd(e){this.getDeviceId().then((a=>{this.searchLogDb.add({device_id:a,content:e,create_date:Date.now()})}))},getDeviceId:()=>new Promise(((e,a)=>{const t=_("uni_id");e(t||k().system+"_"+Math.random().toString(36).substr(2))})),associativeClick(e){console.log("associativeClick: ",e),this.loadList(e.title)},loadList(e=""){m().globalData.searchText=e,L({url:"/pages/list/list"})},backPage(){w()}},watch:{searchText:(N=function(e){e?this.mallGoodsDb.where({title:new RegExp(e,"gi")}).field("_id,title").get().then((e=>{this.associativeList=e.result.data})):(this.associativeList.length=0,m().globalData.searchText="")},j=100,G=N,R=null,P=!0,W&&G(),function(){var e=arguments,a=this;P&&(P=!1,G.apply(a,e)),R&&clearTimeout(R),R=setTimeout((function(){clearTimeout(R),R=null,G.apply(a,e)}),j||200)})}},[["render",function(e,a,i,d,f,_){const y=D(t("uni-search-bar"),F),m=u,b=p,g=D(t("uni-icons"),T),x=D(t("unicloud-db"),H),k=D(t("uni-list-item"),I),L=D(t("uni-list"),B);return s(),l(m,{class:"container"},{default:c((()=>[o(m,{class:"search-container"},{default:c((()=>[o(m,{class:"search-container-bar"},{default:c((()=>[o(y,{ref:"searchBar",style:{flex:"1"},radius:"100",modelValue:f.searchText,"onUpdate:modelValue":a[0]||(a[0]=e=>f.searchText=e),focus:f.focus,placeholder:f.hotWorld,clearButton:"auto",cancelButton:"always",onClear:_.clear,onConfirm:_.confirm,onCancel:_.cancel},null,8,["modelValue","focus","placeholder","onClear","onConfirm","onCancel"])])),_:1})])),_:1}),o(m,{class:"search-body"},{default:c((()=>[f.localSearchList.length?(s(),l(m,{key:0,class:"word-container"},{default:c((()=>[o(m,{class:"word-container_header"},{default:c((()=>[o(b,{class:"word-container_header-text"},{default:c((()=>[r("搜索历史")])),_:1}),f.localSearchListDel?(s(),l(m,{key:1,class:"flex-center flex-row",style:{"font-weight":"500","justify-content":"space-between"}},{default:c((()=>[o(b,{style:{"font-size":"22rpx",color:"#666","padding-top":"4rpx","padding-bottom":"4rpx","padding-right":"20rpx"},onClick:_.LocalSearchListClear},{default:c((()=>[r("全部删除")])),_:1},8,["onClick"]),o(b,{style:{"font-size":"22rpx",color:"#c0402b","padding-top":"4rpx","padding-bottom":"4rpx","padding-left":"20rpx"},onClick:a[2]||(a[2]=e=>f.localSearchListDel=!1)},{default:c((()=>[r("完成")])),_:1})])),_:1})):(s(),l(g,{key:0,onClick:a[1]||(a[1]=e=>f.localSearchListDel=!0),class:"search-icons",style:{"padding-right":"0"},color:f.iconColor,size:"18",type:"trash"},null,8,["color"]))])),_:1}),o(m,{class:"word-container_body"},{default:c((()=>[(s(!0),C(v,null,S(f.localSearchList,((e,a)=>(s(),l(m,{class:"flex-center flex-row word-container_body-text",key:a,onClick:t=>_.LocalSearchlistItemClick(e,a)},{default:c((()=>[(s(),l(b,{class:"word-display",key:e},{default:c((()=>[r(n(e),1)])),_:2},1024)),f.localSearchListDel?(s(),l(g,{key:0,size:"12",type:"closeempty"})):h("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):h("",!0),o(m,{class:"word-container"},{default:c((()=>[o(m,{class:"word-container_header"},{default:c((()=>[o(m,{class:"flex-center flex-row"},{default:c((()=>[o(b,{class:"word-container_header-text"},{default:c((()=>[r("搜索发现")])),_:1}),f.netHotListIsHide?h("",!0):(s(),l(g,{key:0,class:"search-icons",color:f.iconColor,size:"14",type:"reload",onClick:_.searchHotRefresh},null,8,["color","onClick"]))])),_:1}),o(g,{class:"search-icons",style:{"padding-right":"0"},color:f.iconColor,size:"18",type:f.netHotListIsHide?"eye-slash":"eye",onClick:a[3]||(a[3]=e=>f.netHotListIsHide=!f.netHotListIsHide)},null,8,["color","type"])])),_:1}),o(x,{ref:"udb",field:"content",collection:"opendb-search-hot",orderby:"create_date desc,count desc","page-data":"replace","page-size":10},{default:c((({data:e,loading:a,error:t,options:i})=>[a&&!f.netHotListIsHide?(s(),l(b,{key:0,class:"word-container_body-info"},{default:c((()=>[r("正在加载...")])),_:1})):(s(),l(m,{key:1,class:"word-container_body"},{default:c((()=>[f.netHotListIsHide?(s(),l(m,{key:1,style:{flex:"1"}},{default:c((()=>[o(b,{class:"word-container_body-info"},{default:c((()=>[r("当前搜索发现已隐藏")])),_:1})])),_:1})):(s(),C(v,{key:0},[t?(s(),l(b,{key:0,class:"word-container_body-info"},{default:c((()=>[r(n(t.message),1)])),_:2},1024)):(s(!0),C(v,{key:1},S(e,((e,a)=>(s(),l(b,{class:"word-container_body-text",key:a,onClick:a=>_.search(e.content)},{default:c((()=>[r(n(e.content),1)])),_:2},1032,["onClick"])))),128))],64))])),_:2},1024))])),_:1},512)])),_:1})])),_:1}),_.associativeShow?(s(),l(m,{key:0,class:"search-associative"},{default:c((()=>[o(L,null,{default:c((()=>[(s(!0),C(v,null,S(f.associativeList,((e,a)=>(s(),l(k,{key:e._id,ellipsis:1,title:e.name,onClick:a=>_.associativeClick(e),"show-extra-icon":"",clickable:"","extra-icon":{size:18,color:f.iconColor,type:"search"}},null,8,["title","onClick","extra-icon"])))),128))])),_:1})])),_:1})):h("",!0)])),_:1})}],["__scopeId","data-v-3a52629e"]]);export{M as default};
